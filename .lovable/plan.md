
# Исправление навигации на Админ-панель

## Корневая причина

`useAuth` реализован как обычный React hook, а не как Context. Каждый компонент, который вызывает `useAuth()`, создаёт свою независимую копию состояния авторизации. При переходе на `/admin`:

1. `AdminRoute` монтируется и вызывает свой `useAuth()`
2. Новый экземпляр хука начинает с `loading: true`, `user: null`
3. Происходит гонка между `onAuthStateChange` и `getSession()`
4. Если `loading` становится `false` раньше, чем `user` получит значение, `AdminRoute` видит `user = null` и редиректит на `/auth`

## Решение

Превратить `useAuth` в контекст (React Context + Provider), чтобы состояние авторизации было единым для всего приложения. Тогда при переходе на `/admin` компонент `AdminRoute` получит уже загруженное состояние, а не будет ждать нового запроса.

## Что изменится

### 1. Новый файл: `src/contexts/AuthContext.tsx`

Создать React Context и Provider для авторизации:
- `AuthProvider` оборачивает приложение
- Подписывается на `onAuthStateChange` один раз при монтировании
- Хранит `user`, `session`, `loading`, `signOut` в контексте
- `useAuth()` теперь просто читает из контекста (а не создаёт новое состояние)

### 2. Файл: `src/App.tsx`

- Обернуть `BrowserRouter` в `AuthProvider`
- Порядок: `QueryClientProvider` -> `AuthProvider` -> `BrowserRouter` -> ...

### 3. Файл: `src/hooks/useAuth.ts`

- Заменить содержимое на реэкспорт из контекста: `export { useAuth } from "@/contexts/AuthContext"`
- Все существующие импорты `useAuth` продолжат работать без изменений

### 4. Файлы `AdminRoute.tsx`, `ProtectedRoute.tsx`, `Header.tsx` и остальные

- Не нужно менять. Они уже импортируют `useAuth` из `@/hooks/useAuth`, который теперь будет реэкспортировать хук из контекста.

## Результат

- Состояние авторизации инициализируется один раз при запуске приложения
- Все компоненты (Index, AdminRoute, Header) видят одно и то же состояние
- При переходе на `/admin` компонент `AdminRoute` сразу видит `user` -- без повторного запроса к серверу, без race condition
- Навигация на админ-панель будет работать корректно
