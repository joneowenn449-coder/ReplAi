
# План добавления "вайба" компании в настройки

## Обнаруженная структура

1. **Таблица `settings`** содержит:
   - `ai_prompt_template` — текущее поле для промпта ответов на отзывы
   - `brand_name`, `wb_api_key`, `reply_modes` и другие поля

2. **Edge Function `generate-reply`**:
   - Загружает `ai_prompt_template` из settings (строка 95)
   - Использует этот промпт как системное сообщение для ИИ (строка 165)

3. **UI SettingsDialog**:
   - Текущее поле "Промпт для генерации ответов" (строка 309-323)
   - Редактируемое поле Textarea, сохраняется при клике кнопки "Сохранить"

## Что будет реализовано

### Вариант реализации: Просто переименование

Самый простой вариант — это переименовать существующее поле `ai_prompt_template` в UI на "Вайб компании" (или добавить это как основное название). Технически ничего менять не нужно:

- В `SettingsDialog.tsx`: изменить label и description поля
- В `useReviews.ts`: обновить интерфейс Settings (комментарий к полю)
- Edge Function `generate-reply` уже корректно использует это поле

### Что изменится в коде

1. **`src/hooks/useReviews.ts`**:
   - Обновить интерфейс `Settings`: переименовать описание поля `ai_prompt_template` → может остаться как есть (это просто внутренний ключ)

2. **`src/components/SettingsDialog.tsx`**:
   - Изменить label с "Промпт для генерации ответов" на "Вайб компании"
   - Обновить placeholder текст на что-то вроде "Опиши тон, стиль, правила ответов бренда..."
   - Обновить description на "Это описание тона и правил — основа для всех ответов ИИ на отзывы. Всё, что ты напишешь здесь, будет учтено при формировании ответов."

3. **Edge Function `generate-reply/index.ts`**:
   - Ничего менять не нужно! Функция уже корректно использует `ai_prompt_template` как системный промпт

4. **UI/UX улучшения** (опционально):
   - Можно добавить иконку (например, Sparkles или Wand2) рядом с полем
   - Можно добавить примеры того, что можно написать в "вайб"

## Поток работы

1. Пользователь открывает Settings
2. Видит поле "Вайб компании" вместо "Промпт для генерации ответов"
3. Пишет описание: "Отвечаем с юмором, всегда предлагаем решение, благодарим за внимание"
4. Сохраняет
5. Это описание сохраняется в поле `ai_prompt_template` в БД
6. При генерации ответа на отзыв — Edge Function загружает это значение и передаёт как системный промпт ИИ
7. ИИ отвечает в соответствии с "вайбом"

## Технические детали

- **Таблица**: `settings.ai_prompt_template` — уже существует
- **Миграция БД**: не требуется
- **Edge Function**: не требует изменений
- **Новые хуки**: не требуются
- **Новые компоненты**: не требуются
- **RLS**: уже настроена на таблице settings

## Размер изменений

- 1 файл на изменение: `src/components/SettingsDialog.tsx`
- 1 файл на обновление: `src/hooks/useReviews.ts` (комментарии в интерфейсе)
- Время реализации: 5 минут
- Тестирование: проверить, что при изменении "вайба" ответы ИИ изменяются

