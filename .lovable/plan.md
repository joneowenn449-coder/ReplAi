
# Управление AI-балансом через админку

## Что будет сделано

В админ-панели появится возможность видеть и управлять балансом AI-запросов для каждого пользователя -- наравне с токенами. Это позволит вам (как админу) начислить себе или любому пользователю запросы к AI аналитику.

## Изменения

### 1. Таблица пользователей -- добавить колонку "AI запросы"

В таблице пользователей рядом с колонкой "Баланс" (токены) появится колонка **"AI запросы"** с текущим количеством запросов. Кнопки +/- будут работать через выпадающий диалог, где можно выбрать, какой именно баланс пополнять: **токены** или **AI запросы**.

```text
| Пользователь | Телефон | Регистрация | Баланс | AI запросы | Роль | Действия      |
|--------------|---------|-------------|--------|------------|------|---------------|
| Иван         | +7...   | 01 фев 2026 | 42     | 5          | admin| [+T] [-T] [+A] [-A] |
```

### 2. Диалог пополнения/списания -- выбор типа баланса

Текущий диалог будет расширен: при нажатии на кнопки +/- для AI-запросов диалог будет понимать, что работает с таблицей `ai_request_balances` и `ai_request_transactions`, а не с токенами.

### 3. Обзор -- добавить статистику AI-запросов

На вкладке "Обзор" добавится карточка **"Общий баланс AI-запросов"** с суммой по всем пользователям.

### 4. Транзакции -- показывать AI-транзакции

На вкладке "Транзакции" добавится фильтр для просмотра транзакций из таблицы `ai_request_transactions`.

---

## Технические детали

### Файл: `src/hooks/useAdmin.ts`

1. **`useAdminUsers`** -- добавить запрос `ai_request_balances` и маппинг `aiBalance` на каждого пользователя.

2. **`useUpdateAiBalance`** -- новая мутация аналогичная `useUpdateBalance`, но работающая с таблицами `ai_request_balances` и `ai_request_transactions`.

3. **`useAdminOverview`** -- добавить запрос суммарного баланса AI-запросов.

4. **`useAdminAiTransactions`** -- новый хук для выборки из `ai_request_transactions`.

### Файл: `src/components/admin/UsersTable.tsx`

1. Добавить колонку "AI запросы" в таблицу.
2. Добавить кнопки +/- для AI-баланса (отдельные от токенов).
3. Диалог -- определять целевую таблицу по типу действия (`token` vs `ai`), вызывать соответствующую мутацию.

### Файл: `src/components/admin/AdminOverview.tsx`

1. Добавить карточку "Общий баланс AI-запросов" с иконкой `BrainCircuit`.

### Файл: `src/components/admin/TransactionsTable.tsx`

1. Добавить переключатель "Токены / AI запросы" для просмотра транзакций из разных таблиц.

### Файл: `src/integrations/supabase/types.ts`

Не трогаем -- файл обновляется автоматически, таблицы `ai_request_balances` и `ai_request_transactions` уже в схеме.
