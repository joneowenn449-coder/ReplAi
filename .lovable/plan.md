

# Короткие благодарности для пустых отзывов с 4-5 звёздами

## Что нужно сделать

Для пустых отзывов (без текста, плюсов и минусов) с рейтингом 4 или 5 звёзд -- генерировать короткий ответ-благодарность за высокую оценку вместо стандартного развёрнутого ответа. Режимы (авто/ручной) работают как обычно.

## Что будет изменено

### 1. `supabase/functions/generate-reply/index.ts`

Добавить проверку: если отзыв пустой (нет `text`, `pros`, `cons`) и рейтинг 4 или 5, использовать специальный короткий промпт вместо основного:

```text
Специальный промпт для пустых 4-5 звёзд:
"Покупатель оставил оценку [N] из 5 без текста. 
 Напиши краткую благодарность за высокую оценку. 
 Максимум 1-2 предложения. Без лишних деталей."
```

Основной `ai_prompt_template` из настроек в этом случае не используется -- ответ должен быть максимально коротким.

### 2. `supabase/functions/sync-reviews/index.ts`

Аналогичная логика в функции `generateAIReply`:
- Добавить параметр `isEmpty` (отзыв без текста)
- Если `isEmpty === true` и рейтинг 4 или 5 -- использовать короткий промпт благодарности
- Для пустых отзывов с рейтингом 1-3 -- оставить стандартное поведение (развёрнутый ответ)

### Схема логики

```text
Пустой отзыв?
  ├── Нет  --> стандартная генерация (как сейчас)
  └── Да
       ├── Рейтинг 4-5 --> короткая благодарность (1-2 предложения)
       └── Рейтинг 1-3 --> стандартная генерация (как сейчас)
```

## Что НЕ меняется

- Режимы авто/ручной работают без изменений для всех отзывов
- UI остаётся прежним
- Для отзывов с текстом ничего не меняется
- База данных не затрагивается

## Файлы

| Файл | Изменение |
|------|-----------|
| `supabase/functions/generate-reply/index.ts` | Короткий промпт для пустых 4-5 звёзд |
| `supabase/functions/sync-reviews/index.ts` | Та же логика в `generateAIReply` |

