

# Исправление видимости отзывов

## Проблема

Два отзыва без текста видны на Wildberries, но не попадают в систему. Причины:

1. **Синхронизация не подхватывает все отзывы** -- WB API на момент синхронизации возвращает 0 неотвеченных, хотя они есть на скриншоте. Возможна задержка индексации WB, нужна пагинация и повторная попытка.
2. **Лимит 1000 строк** -- в базе 1051 отзыв, Supabase по умолчанию отдает максимум 1000 строк. Часть данных скрыта.

## Решение

### 1. Добавить пагинацию в WB API запрос (sync-reviews)

**Файл: `supabase/functions/sync-reviews/index.ts`**

Сейчас функция делает один запрос на 50 отзывов. Если у WB API есть больше -- они теряются. Нужно загружать все страницы:

```text
Текущая логика:
  fetchWBReviews(apiKey) --> один запрос, take=50

Новая логика:
  Цикл: 
    Запрос take=50, skip=0
    Запрос take=50, skip=50
    ... пока приходят данные
    Объединить все отзывы
```

### 2. Убрать лимит 1000 строк на фронтенде (useReviews)

**Файл: `src/hooks/useReviews.ts`**

Supabase по умолчанию возвращает максимум 1000 строк. С 1051+ отзывами часть данных не отображается. Нужно загружать все записи постранично:

```text
Текущая логика:
  supabase.from("reviews").select("*").order(...) 
  --> Supabase вернёт только 1000 строк

Новая логика:
  Запрос порциями по 1000:
    select("*").range(0, 999)
    select("*").range(1000, 1999)
    ... пока приходят данные
    Объединить все результаты
```

## Файлы

| Файл | Изменение |
|------|-----------|
| `supabase/functions/sync-reviews/index.ts` | Пагинация запросов к WB API -- загрузка всех страниц |
| `src/hooks/useReviews.ts` | Загрузка всех отзывов из БД без лимита 1000 |

## Ожидаемый результат

- Синхронизация подхватит все неотвеченные отзывы с WB, даже если их больше 50
- Интерфейс покажет все отзывы из базы данных, а не только первые 1000

