

# Гарантированное отображение баланса токенов после переноса

## Проблема

При переносе проекта через GitHub на новом аккаунте не отображается баланс токенов и кнопка "Пополнить" из-за двух причин:

1. **Условие в Header.tsx** (строка 116) скрывает весь блок, пока `tokenBalance` равен `undefined` (во время загрузки) или `null`
2. **Триггер на auth.users** мог не примениться при переносе, т.к. это системная таблица Supabase

## Решение

### 1. Сделать отображение баланса устойчивым (Header.tsx)

Заменить условие на строке 116:

**Было:**
```tsx
{tokenBalance !== null && tokenBalance !== undefined && (
```

**Станет:**
```tsx
{user && (
```

Логика: если пользователь залогинен -- всегда показываем блок токенов. Значение баланса при загрузке будет `0` (fallback из `useBalance`), а после загрузки -- реальное значение.

### 2. Триггер уже исправлен

Миграция с триггером `on_auth_user_created` уже добавлена в файл `supabase/migrations/20260215070600_...sql`. При переносе через GitHub она выполнится, и при регистрации нового пользователя автоматически создадутся записи в `token_balances`, `profiles` и остальных таблицах.

## Итог

Одно изменение в одном файле: `src/components/Header.tsx`, строка 116. Токены и кнопка "Пополнить" будут видны всегда для залогиненного пользователя.
