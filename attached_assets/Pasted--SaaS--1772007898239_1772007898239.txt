Нам нужно обновить существующую админ-панель (дашборд пользователей) в нашем SaaS-сервисе. Базовый функционал уже работает, нужно только добавить новые метрики и колонки в базу данных, API и фронтенд, не переписывая весь модуль с нуля.

Текущая структура данных пользователя:

ID пользователя, Имя / Email, Телефон

Статус (Active / Trial / Expired)

Сумма оплат (в рублях), История платежей

Дата регистрации, Последняя активность

Количество подключённых WB-кабинетов

Telegram (username/имя)

Баланс токенов и AI-запросов

Сессии и устройства, Заметки администратора.

Что нужно ДОБАВИТЬ (Update Requirements):

1. Изменения в Базе Данных (добавить поля/вычисляемые метрики):
Добавь в таблицу пользователей (или в связанную таблицу статистики) следующие поля:

wb_api_status (Enum или String: 'connected_ok', 'error_401', 'not_connected'). Статус API ключа Wildberries.

first_response_date (DateTime). Дата первой успешной генерации ответа (для отслеживания Time-to-Value).

tokens_spent_per_day (Int/Float). Средний расход токенов в день (Token Velocity).

vision_usage_percent (Int/Float). Процент ответов с использованием AI Vision от общего числа сгенерированных ответов.

avg_daily_reviews (Int). Среднее количество входящих отзывов в день (чтобы понимать масштаб селлера).

has_ai_analytics_sub (Boolean). Наличие активной подписки на AI-аналитика.

2. Изменения в UI (Главная таблица пользователей):

Добавь новые колонки в общую таблицу: Статус API (выводить бейджем: зеленый - ОК, красный - Ошибка, серый - Нет), Расход/день (tokens_spent_per_day), % Vision, AI Аналитик (Да/Нет).

Добавь систему алертов (Churn Alerts) в виде иконок/цветов в строке пользователя:

Красный флаг/иконка: Если wb_api_status == 'error_401'.

Желтый флаг/иконка (Zero Usage): Если баланс токенов > 0, но tokens_spent_per_day == 0 (или не было генераций последние 3 дня).

3. Изменения в Детальной карточке пользователя (Модалка/Слайдер):

Организуй новые данные в блок "Метрики использования (SaaS Metrics)":

Статус подключения API WB (с датой последней проверки).

Средний расход токенов в день.

Использование фичи "Анализ фото" (% от всех ответов).

Объем входящих отзывов в день (в среднем).

Статус подписки на AI Аналитика.

4. Изменения в CSV-экспорте:

Добавь новые поля в функцию экспорта CSV: Статус API WB, Средний расход токенов в день, % использования Vision, Среднее кол-во отзывов в день, Подписка AI Аналитик.

Ограничения (Constraints):

Напиши только необходимые миграции для БД (или SQL-запросы ALTER TABLE).

Покажи, как обновить существующий API эндпоинт получения пользователей (чтобы он отдавал новые вычисляемые поля).

Покажи изменения в React/Vue (или том фреймворке, что мы используем) компоненте таблицы.

Не ломай текущую логику статусов (Active/Trial/Expired) и балансов.